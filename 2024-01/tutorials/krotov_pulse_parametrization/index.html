<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Pulse Parametrization for Krotov&#39;s Method · Examples</title><meta name="title" content="Pulse Parametrization for Krotov&#39;s Method · Examples"/><meta property="og:title" content="Pulse Parametrization for Krotov&#39;s Method · Examples"/><meta property="twitter:title" content="Pulse Parametrization for Krotov&#39;s Method · Examples"/><meta name="description" content="Documentation for Examples."/><meta property="og:description" content="Documentation for Examples."/><meta property="twitter:description" content="Documentation for Examples."/><meta property="og:url" content="https://juliaquantumcontrol.github.io/QuantumControlExamples.jl/tutorials/krotov_pulse_parametrization/"/><meta property="twitter:url" content="https://juliaquantumcontrol.github.io/QuantumControlExamples.jl/tutorials/krotov_pulse_parametrization/"/><link rel="canonical" href="https://juliaquantumcontrol.github.io/QuantumControlExamples.jl/tutorials/krotov_pulse_parametrization/"/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../assets/citations.css" rel="stylesheet" type="text/css"/><link href="../../assets/custom.css" rel="stylesheet" type="text/css"/><script src="../../assets/custom.js"></script><link href="https://juliaquantumcontrol.github.io/QuantumControl.jl/dev/assets/topbar/topbar.css" rel="stylesheet" type="text/css"/><script src="https://juliaquantumcontrol.github.io/QuantumControl.jl/dev/assets/topbar/topbar.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">Examples</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="../">List of Tutorials</a></li><li class="is-active"><a class="tocitem" href>Pulse Parametrization for Krotov&#39;s Method</a><ul class="internal"><li><a class="tocitem" href="#Parametrizations"><span>Parametrizations</span></a></li><li><a class="tocitem" href="#Symmetric-Bounded-Controls"><span>Symmetric Bounded Controls</span></a></li><li><a class="tocitem" href="#Positive-(Bounded)-Controls"><span>Positive (Bounded) Controls</span></a></li><li><a class="tocitem" href="#Two-level-Hamiltonian"><span>Two-level Hamiltonian</span></a></li><li><a class="tocitem" href="#Optimization-target"><span>Optimization target</span></a></li><li><a class="tocitem" href="#Square-parametrization-for-positive-pulses"><span>Square-parametrization for positive pulses</span></a></li><li><a class="tocitem" href="#Tanh-Square-Parametrization-for-positive-amplitude-constrained-pulses"><span>Tanh-Square-Parametrization for positive amplitude-constrained pulses</span></a></li><li><a class="tocitem" href="#Logistic-Square-Parametrization-for-positive-amplitude-constrained-pulses"><span>Logistic-Square-Parametrization for positive amplitude-constrained pulses</span></a></li><li><a class="tocitem" href="#Tanh-parametrization-for-amplitude-constrained-pulses"><span>Tanh-parametrization for amplitude-constrained pulses</span></a></li></ul></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../../examples/">List of Examples</a></li></ul></li><li><a class="tocitem" href="../../references/">References</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Tutorials</a></li><li class="is-active"><a href>Pulse Parametrization for Krotov&#39;s Method</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Pulse Parametrization for Krotov&#39;s Method</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/JuliaQuantumControl/QuantumControlExamples.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/JuliaQuantumControl/QuantumControlExamples.jl/blob/master/docs/src/tutorials/krotov_pulse_parametrization/krotov_pulse_parametrization.jl" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Pulse-Parametrization-for-Krotov&#39;s-Method"><a class="docs-heading-anchor" href="#Pulse-Parametrization-for-Krotov&#39;s-Method">Pulse Parametrization for Krotov&#39;s Method</a><a id="Pulse-Parametrization-for-Krotov&#39;s-Method-1"></a><a class="docs-heading-anchor-permalink" href="#Pulse-Parametrization-for-Krotov&#39;s-Method" title="Permalink"></a></h1><p><span>$\gdef\op#1{\hat{#1}}$</span> <span>$\gdef\init{\text{init}}$</span> <span>$\gdef\tgt{\text{tgt}}$</span></p><p>This example illustrates the parametrization of control pulses as a form of amplitude constraint.</p><pre><code class="language-julia hljs">datadir(names...) = joinpath(@__DIR__, names...);</code></pre><pre><code class="language-julia hljs">using QuantumControl
using QuantumControl.Shapes: flattop
using QuantumControl.Generators
using QuantumControl.Controls
using QuantumControl.PulseParametrizations:
    SquareParametrization,
    TanhParametrization,
    TanhSqParametrization,
    LogisticParametrization,
    LogisticSqParametrization,
    ParametrizedAmplitude
using QuantumPropagators: ExpProp
using LinearAlgebra</code></pre><pre><code class="language-julia hljs">using Plots
Plots.default(
    linewidth               = 3,
    size                    = (550, 300),
    legend                  = :top,
    foreground_color_legend = nothing,
    background_color_legend = RGBA(1, 1, 1, 0.8),
)</code></pre><h2 id="Parametrizations"><a class="docs-heading-anchor" href="#Parametrizations">Parametrizations</a><a id="Parametrizations-1"></a><a class="docs-heading-anchor-permalink" href="#Parametrizations" title="Permalink"></a></h2><h2 id="Symmetric-Bounded-Controls"><a class="docs-heading-anchor" href="#Symmetric-Bounded-Controls">Symmetric Bounded Controls</a><a id="Symmetric-Bounded-Controls-1"></a><a class="docs-heading-anchor-permalink" href="#Symmetric-Bounded-Controls" title="Permalink"></a></h2><p><img src="krotov_pulse_parametrization-11.png" alt/></p><h2 id="Positive-(Bounded)-Controls"><a class="docs-heading-anchor" href="#Positive-(Bounded)-Controls">Positive (Bounded) Controls</a><a id="Positive-(Bounded)-Controls-1"></a><a class="docs-heading-anchor-permalink" href="#Positive-(Bounded)-Controls" title="Permalink"></a></h2><p><img src="krotov_pulse_parametrization-13.png" alt/></p><h2 id="Two-level-Hamiltonian"><a class="docs-heading-anchor" href="#Two-level-Hamiltonian">Two-level Hamiltonian</a><a id="Two-level-Hamiltonian-1"></a><a class="docs-heading-anchor-permalink" href="#Two-level-Hamiltonian" title="Permalink"></a></h2><p>We consider the Hamiltonian <span>$\op{H}_{0} = - \frac{\omega}{2} \op{\sigma}_{z}$</span>, representing a simple qubit with energy level splitting <span>$\omega$</span> in the basis <span>$\{\ket{0},\ket{1}\}$</span>. The control field <span>$\epsilon(t)$</span> is assumed to couple via the Hamiltonian <span>$\op{H}_{1}(t) = \epsilon(t) \op{\sigma}_{x}$</span> to the qubit, i.e., the control field effectively drives transitions between both qubit states.</p><p>We we will use</p><pre><code class="language-julia hljs">ϵ(t) = 0.2 * flattop(t, T=5, t_rise=0.3, func=:blackman);</code></pre><pre><code class="language-julia hljs">&quot;&quot;&quot;Two-level-system Hamiltonian.&quot;&quot;&quot;
function tls_hamiltonian(; Ω=1.0, ampl=ϵ)
    σ̂_z = ComplexF64[
        1  0
        0 -1
    ]
    σ̂_x = ComplexF64[
        0  1
        1  0
    ]
    Ĥ₀ = -0.5 * Ω * σ̂_z
    Ĥ₁ = σ̂_x
    return hamiltonian(Ĥ₀, (Ĥ₁, ampl))
end;</code></pre><pre><code class="language-julia hljs">H = tls_hamiltonian();</code></pre><p>The control field here switches on from zero at <span>$t=0$</span> to it&#39;s maximum amplitude 0.2 within the time period 0.3 (the switch-on shape is half a <a href="https://en.wikipedia.org/wiki/Window_function#Blackman_window">Blackman pulse</a>). It switches off again in the time period 0.3 before the final time <span>$T=5$</span>). We use a time grid with 500 time steps between 0 and <span>$T$</span>:</p><pre><code class="language-julia hljs">tlist = collect(range(0, 5, length=500));</code></pre><pre><code class="language-julia hljs">function plot_amplitude(ampl, tlist)
    plot(tlist, discretize(ampl, tlist), xlabel=&quot;time&quot;, ylabel=&quot;amplitude&quot;, legend=false)
end

fig = plot_amplitude(ϵ, tlist)</code></pre><p><img src="krotov_pulse_parametrization-21.png" alt/></p><h2 id="Optimization-target"><a class="docs-heading-anchor" href="#Optimization-target">Optimization target</a><a id="Optimization-target-1"></a><a class="docs-heading-anchor-permalink" href="#Optimization-target" title="Permalink"></a></h2><p>The <code>Krotov</code> package requires the optimization to be expressed over a set of &quot;trajectories&quot;. In this example, there is only a single trajectory: the state-to-state transfer from initial state <span>$\ket{\Psi_{\init}} = \ket{0}$</span> to the target state <span>$\ket{\Psi_{\tgt}} = \ket{1}$</span>, under the dynamics of the Hamiltonian <span>$\op{H}(t)$</span>:</p><pre><code class="language-julia hljs">function ket(label)
    result = Dict(&quot;0&quot; =&gt; Vector{ComplexF64}([1, 0]), &quot;1&quot; =&gt; Vector{ComplexF64}([0, 1]),)
    return result[string(label)]
end;</code></pre><pre><code class="language-julia hljs">trajectories = [Trajectory(ket(0), H, target_state=ket(1))]</code></pre><pre><code class="nohighlight hljs">1-element Vector{QuantumControlBase.Trajectory{Vector{ComplexF64}, QuantumPropagators.Generators.Generator{Matrix{ComplexF64}, typeof(Main.var&quot;##225&quot;.ϵ)}}}:
 Trajectory with 2-element Vector{ComplexF64} initial state, Generator with 2 ops and 1 amplitudes, 2-element Vector{ComplexF64} target state</code></pre><h2 id="Square-parametrization-for-positive-pulses"><a class="docs-heading-anchor" href="#Square-parametrization-for-positive-pulses">Square-parametrization for positive pulses</a><a id="Square-parametrization-for-positive-pulses-1"></a><a class="docs-heading-anchor-permalink" href="#Square-parametrization-for-positive-pulses" title="Permalink"></a></h2><pre><code class="language-julia hljs">a = ParametrizedAmplitude(
    ϵ,
    tlist;
    parametrization=SquareParametrization(),
    parameterize=true
)</code></pre><pre><code class="nohighlight hljs">ParametrizedAmplitude(::Vector{Float64}; parametrization=SquareParametrization())</code></pre><pre><code class="language-julia hljs">function plot_amplitude(ampl::ParametrizedAmplitude, tlist)
    plot(
        tlist,
        discretize(Array(ampl), tlist),
        xlabel=&quot;time&quot;,
        ylabel=&quot;amplitude&quot;,
        legend=false
    )
end

fig = plot_amplitude(a, tlist)</code></pre><p><img src="krotov_pulse_parametrization-28.png" alt/></p><pre><code class="language-julia hljs">problem = ControlProblem(
    trajectories=substitute(trajectories, IdDict(ϵ =&gt; a)),
    prop_method=ExpProp,
    lambda_a=5,
    update_shape=(t -&gt; flattop(t, T=5, t_rise=0.3, func=:blackman)),
    tlist=tlist,
    iter_stop=50,
    J_T=QuantumControl.Functionals.J_T_ss,
    check_convergence=res -&gt; begin
        ((res.J_T &lt; 1e-3) &amp;&amp; (res.converged = true) &amp;&amp; (res.message = &quot;J_T &lt; 10⁻³&quot;))
    end
);</code></pre><pre><code class="language-julia hljs">using Krotov
opt_result_positive = @optimize_or_load(
    datadir(&quot;parametrization#opt_result_positive.jld2&quot;),
    problem;
    method=Krotov
);</code></pre><pre><code class="nohighlight hljs"> iter.        J_T   ∫gₐ(t)dt          J       ΔJ_T         ΔJ    secs
     0   9.51e-01   0.00e+00   9.51e-01        n/a        n/a     3.7
[ Info: Set callback to store result in /net/storage/mgoerz/QuantumControlExamples.jl/tutorials/krotov_pulse_parametrization/parametrization#opt_result_positive.jld2 on unexpected exit.
     1   9.31e-01   9.29e-03   9.40e-01  -2.05e-02  -1.12e-02     1.7
     2   9.01e-01   1.34e-02   9.15e-01  -2.96e-02  -1.63e-02     0.0
     3   8.59e-01   1.91e-02   8.78e-01  -4.25e-02  -2.34e-02     0.0
     4   7.99e-01   2.67e-02   8.26e-01  -5.96e-02  -3.29e-02     0.0
     5   7.20e-01   3.56e-02   7.56e-01  -7.91e-02  -4.35e-02     0.0
     6   6.25e-01   4.33e-02   6.68e-01  -9.52e-02  -5.19e-02     0.0
     7   5.25e-01   4.62e-02   5.72e-01  -9.96e-02  -5.33e-02     0.0
     8   4.36e-01   4.25e-02   4.79e-01  -8.92e-02  -4.66e-02     0.0
     9   3.65e-01   3.49e-02   4.00e-01  -7.14e-02  -3.64e-02     0.0
    10   3.10e-01   2.74e-02   3.37e-01  -5.48e-02  -2.74e-02 …
    37   5.05e-02   8.59e-04   5.13e-02  -1.70e-03  -8.45e-04     0.0
    38   4.89e-02   8.05e-04   4.97e-02  -1.60e-03  -7.93e-04     0.0
    39   4.74e-02   7.56e-04   4.81e-02  -1.50e-03  -7.45e-04     0.0
    40   4.60e-02   7.12e-04   4.67e-02  -1.41e-03  -7.02e-04     0.0
    41   4.46e-02   6.71e-04   4.53e-02  -1.33e-03  -6.62e-04     0.0
    42   4.34e-02   6.34e-04   4.40e-02  -1.26e-03  -6.26e-04     0.0
    43   4.22e-02   5.99e-04   4.28e-02  -1.19e-03  -5.92e-04     0.0
    44   4.11e-02   5.68e-04   4.16e-02  -1.13e-03  -5.61e-04     0.0
    45   4.00e-02   5.38e-04   4.05e-02  -1.07e-03  -5.32e-04     0.0
    46   3.90e-02   5.11e-04   3.95e-02  -1.02e-03  -5.06e-04     0.0
    47   3.80e-02   4.86e-04   3.85e-02  -9.67e-04  -4.81e-04     0.0
    48   3.71e-02   4.63e-04   3.75e-02  -9.21e-04  -4.58e-04     0.0
    49   3.62e-02   4.41e-04   3.66e-02  -8.78e-04  -4.37e-04     0.0
    50   3.54e-02   4.21e-04   3.58e-02  -8.38e-04  -4.17e-04     0.0

</code></pre><pre><code class="language-julia hljs">opt_result_positive</code></pre><pre><code class="nohighlight hljs">Krotov Optimization Result
--------------------------
- Started at 2024-01-23T22:48:53.606
- Number of trajectories: 1
- Number of iterations: 50
- Value of functional: 3.53585e-02
- Reason for termination: Reached maximum number of iterations
- Ended at 2024-01-23T22:48:59.552 (5 seconds, 946 milliseconds)
</code></pre><p>We can plot the optimized field:</p><pre><code class="language-julia hljs">fig = plot_amplitude(
    substitute(a, IdDict(a.control =&gt; opt_result_positive.optimized_controls[1])),
    tlist
)</code></pre><p><img src="krotov_pulse_parametrization-33.png" alt/></p><h2 id="Tanh-Square-Parametrization-for-positive-amplitude-constrained-pulses"><a class="docs-heading-anchor" href="#Tanh-Square-Parametrization-for-positive-amplitude-constrained-pulses">Tanh-Square-Parametrization for positive amplitude-constrained pulses</a><a id="Tanh-Square-Parametrization-for-positive-amplitude-constrained-pulses-1"></a><a class="docs-heading-anchor-permalink" href="#Tanh-Square-Parametrization-for-positive-amplitude-constrained-pulses" title="Permalink"></a></h2><pre><code class="language-julia hljs">a = ParametrizedAmplitude(
    ϵ,
    tlist;
    parametrization=TanhSqParametrization(3),
    parameterize=true
)

problem_tanhsq = ControlProblem(
    trajectories=substitute(trajectories, IdDict(ϵ =&gt; a)),
    prop_method=ExpProp,
    lambda_a=10,
    update_shape=(t -&gt; flattop(t, T=5, t_rise=0.3, func=:blackman)),
    tlist=tlist,
    iter_stop=50,
    J_T=QuantumControl.Functionals.J_T_ss,
    check_convergence=res -&gt; begin
        ((res.J_T &lt; 1e-3) &amp;&amp; (res.converged = true) &amp;&amp; (res.message = &quot;J_T &lt; 10⁻³&quot;))
    end
);</code></pre><pre><code class="language-julia hljs">opt_result_tanhsq = @optimize_or_load(
    datadir(&quot;parametrization#opt_result_tanhsq.jld2&quot;),
    problem_tanhsq;
    method=Krotov
);</code></pre><pre><code class="nohighlight hljs"> iter.        J_T   ∫gₐ(t)dt          J       ΔJ_T         ΔJ    secs
     0   9.51e-01   0.00e+00   9.51e-01        n/a        n/a     0.1
[ Info: Set callback to store result in /net/storage/mgoerz/QuantumControlExamples.jl/tutorials/krotov_pulse_parametrization/parametrization#opt_result_tanhsq.jld2 on unexpected exit.
     1   9.24e-01   1.21e-02   9.36e-01  -2.76e-02  -1.54e-02     0.0
     2   8.81e-01   1.90e-02   9.00e-01  -4.32e-02  -2.42e-02     0.0
     3   8.15e-01   2.88e-02   8.44e-01  -6.54e-02  -3.65e-02     0.0
     4   7.24e-01   4.06e-02   7.65e-01  -9.08e-02  -5.02e-02     0.0
     5   6.16e-01   4.99e-02   6.65e-01  -1.09e-01  -5.90e-02     0.0
     6   5.08e-01   5.11e-02   5.59e-01  -1.08e-01  -5.66e-02     0.0
     7   4.19e-01   4.38e-02   4.62e-01  -8.92e-02  -4.54e-02     0.0
     8   3.52e-01   3.37e-02   3.85e-01  -6.69e-02  -3.33e-02     0.0
     9   3.02e-01   2.51e-02   3.28e-01  -4.92e-02  -2.41e-02     0.0
    10   2.66e-01   1.89e-02   2.84e-01  -3.69e-02  -1.79e-02   …
    37   8.06e-02   7.52e-04   8.14e-02  -1.49e-03  -7.37e-04     0.0
    38   7.92e-02   7.10e-04   8.00e-02  -1.41e-03  -6.96e-04     0.0
    39   7.79e-02   6.72e-04   7.86e-02  -1.33e-03  -6.59e-04     0.0
    40   7.67e-02   6.36e-04   7.73e-02  -1.26e-03  -6.24e-04     0.0
    41   7.55e-02   6.03e-04   7.61e-02  -1.20e-03  -5.92e-04     0.0
    42   7.43e-02   5.73e-04   7.49e-02  -1.14e-03  -5.63e-04     0.0
    43   7.32e-02   5.45e-04   7.38e-02  -1.08e-03  -5.35e-04     0.0
    44   7.22e-02   5.19e-04   7.27e-02  -1.03e-03  -5.10e-04     0.0
    45   7.12e-02   4.95e-04   7.17e-02  -9.81e-04  -4.87e-04     0.0
    46   7.03e-02   4.72e-04   7.08e-02  -9.37e-04  -4.65e-04     0.0
    47   6.94e-02   4.52e-04   6.98e-02  -8.96e-04  -4.44e-04     0.0
    48   6.85e-02   4.32e-04   6.90e-02  -8.57e-04  -4.25e-04     0.0
    49   6.77e-02   4.14e-04   6.81e-02  -8.21e-04  -4.07e-04     0.0
    50   6.69e-02   3.97e-04   6.73e-02  -7.87e-04  -3.91e-04     0.0

</code></pre><pre><code class="language-julia hljs">opt_result_tanhsq</code></pre><pre><code class="nohighlight hljs">Krotov Optimization Result
--------------------------
- Started at 2024-01-23T22:49:02.319
- Number of trajectories: 1
- Number of iterations: 50
- Value of functional: 6.69321e-02
- Reason for termination: Reached maximum number of iterations
- Ended at 2024-01-23T22:49:02.878 (559 milliseconds)
</code></pre><p>We can plot the optimized field:</p><pre><code class="language-julia hljs">fig = plot_amplitude(
    substitute(a, IdDict(a.control =&gt; opt_result_tanhsq.optimized_controls[1])),
    tlist
)</code></pre><p><img src="krotov_pulse_parametrization-39.png" alt/></p><h2 id="Logistic-Square-Parametrization-for-positive-amplitude-constrained-pulses"><a class="docs-heading-anchor" href="#Logistic-Square-Parametrization-for-positive-amplitude-constrained-pulses">Logistic-Square-Parametrization for positive amplitude-constrained pulses</a><a id="Logistic-Square-Parametrization-for-positive-amplitude-constrained-pulses-1"></a><a class="docs-heading-anchor-permalink" href="#Logistic-Square-Parametrization-for-positive-amplitude-constrained-pulses" title="Permalink"></a></h2><pre><code class="language-julia hljs">a = ParametrizedAmplitude(
    ϵ,
    tlist;
    parametrization=LogisticSqParametrization(3, k=1.0),
    parameterize=true
)

problem_logisticsq = ControlProblem(
    trajectories=substitute(trajectories, IdDict(ϵ =&gt; a)),
    prop_method=ExpProp,
    lambda_a=1,
    update_shape=(t -&gt; flattop(t, T=5, t_rise=0.3, func=:blackman)),
    tlist=tlist,
    iter_stop=50,
    J_T=QuantumControl.Functionals.J_T_ss,
    check_convergence=res -&gt; begin
        ((res.J_T &lt; 1e-3) &amp;&amp; (res.converged = true) &amp;&amp; (res.message = &quot;J_T &lt; 10⁻³&quot;))
    end
);</code></pre><pre><code class="language-julia hljs">opt_result_logisticsq = @optimize_or_load(
    datadir(&quot;parametrization#opt_result_logisticsq.jld2&quot;),
    problem_logisticsq;
    method=Krotov
);</code></pre><pre><code class="nohighlight hljs"> iter.        J_T   ∫gₐ(t)dt          J       ΔJ_T         ΔJ    secs
     0   9.51e-01   0.00e+00   9.51e-01        n/a        n/a     0.1
[ Info: Set callback to store result in /net/storage/mgoerz/QuantumControlExamples.jl/tutorials/krotov_pulse_parametrization/parametrization#opt_result_logisticsq.jld2 on unexpected exit.
     1   8.72e-01   2.97e-02   9.02e-01  -7.91e-02  -4.93e-02     0.0
     2   6.93e-01   6.94e-02   7.63e-01  -1.79e-01  -1.10e-01     0.0
     3   4.57e-01   1.03e-01   5.60e-01  -2.36e-01  -1.33e-01     0.0
     4   3.07e-01   7.51e-02   3.82e-01  -1.50e-01  -7.49e-02     0.0
     5   2.31e-01   4.00e-02   2.71e-01  -7.60e-02  -3.60e-02     0.0
     6   1.87e-01   2.31e-02   2.10e-01  -4.37e-02  -2.06e-02     0.0
     7   1.59e-01   1.48e-02   1.74e-01  -2.82e-02  -1.34e-02     0.0
     8   1.39e-01   1.03e-02   1.49e-01  -1.97e-02  -9.38e-03     0.0
     9   1.25e-01   7.53e-03   1.32e-01  -1.45e-02  -6.93e-03     0.0
    10   1.14e-01   5.74e-03   1.19e-01  -1.11e-02  -5.33e-0…
    37   4.98e-02   3.05e-04   5.01e-02  -6.03e-04  -2.99e-04     0.0
    38   4.92e-02   2.88e-04   4.95e-02  -5.71e-04  -2.83e-04     0.0
    39   4.87e-02   2.74e-04   4.89e-02  -5.42e-04  -2.68e-04     0.0
    40   4.81e-02   2.60e-04   4.84e-02  -5.15e-04  -2.55e-04     0.0
    41   4.76e-02   2.47e-04   4.79e-02  -4.90e-04  -2.43e-04     0.0
    42   4.72e-02   2.35e-04   4.74e-02  -4.66e-04  -2.31e-04     0.0
    43   4.67e-02   2.24e-04   4.70e-02  -4.45e-04  -2.20e-04     0.0
    44   4.63e-02   2.14e-04   4.65e-02  -4.25e-04  -2.11e-04     0.0
    45   4.59e-02   2.05e-04   4.61e-02  -4.06e-04  -2.01e-04     0.0
    46   4.55e-02   1.96e-04   4.57e-02  -3.88e-04  -1.93e-04     0.0
    47   4.51e-02   1.87e-04   4.53e-02  -3.72e-04  -1.84e-04     0.0
    48   4.48e-02   1.80e-04   4.50e-02  -3.57e-04  -1.77e-04     0.0
    49   4.44e-02   1.72e-04   4.46e-02  -3.42e-04  -1.70e-04     0.0
    50   4.41e-02   1.66e-04   4.43e-02  -3.29e-04  -1.63e-04     0.0

</code></pre><p>We can plot the optimized field:</p><pre><code class="language-julia hljs">fig = plot_amplitude(
    substitute(a, IdDict(a.control =&gt; opt_result_logisticsq.optimized_controls[1])),
    tlist
)</code></pre><p><img src="krotov_pulse_parametrization-44.png" alt/></p><h2 id="Tanh-parametrization-for-amplitude-constrained-pulses"><a class="docs-heading-anchor" href="#Tanh-parametrization-for-amplitude-constrained-pulses">Tanh-parametrization for amplitude-constrained pulses</a><a id="Tanh-parametrization-for-amplitude-constrained-pulses-1"></a><a class="docs-heading-anchor-permalink" href="#Tanh-parametrization-for-amplitude-constrained-pulses" title="Permalink"></a></h2><pre><code class="language-julia hljs">a = ParametrizedAmplitude(
    ϵ,
    tlist;
    parametrization=TanhParametrization(-0.5, 0.5),
    parameterize=true
)

problem_tanh = ControlProblem(
    trajectories=substitute(trajectories, IdDict(ϵ =&gt; a)),
    prop_method=ExpProp,
    lambda_a=1,
    update_shape=(t -&gt; flattop(t, T=5, t_rise=0.3, func=:blackman)),
    tlist=tlist,
    iter_stop=50,
    J_T=QuantumControl.Functionals.J_T_ss,
    check_convergence=res -&gt; begin
        ((res.J_T &lt; 1e-3) &amp;&amp; (res.converged = true) &amp;&amp; (res.message = &quot;J_T &lt; 10⁻³&quot;))
    end
);</code></pre><pre><code class="language-julia hljs">opt_result_tanh = @optimize_or_load(
    datadir(&quot;parametrization#opt_result_tanh.jld2&quot;),
    problem_tanh;
    method=Krotov
);</code></pre><pre><code class="nohighlight hljs"> iter.        J_T   ∫gₐ(t)dt          J       ΔJ_T         ΔJ    secs
     0   9.51e-01   0.00e+00   9.51e-01        n/a        n/a     0.2
[ Info: Set callback to store result in /net/storage/mgoerz/QuantumControlExamples.jl/tutorials/krotov_pulse_parametrization/parametrization#opt_result_tanh.jld2 on unexpected exit.
     1   9.27e-01   1.09e-02   9.38e-01  -2.40e-02  -1.31e-02     0.0
     2   8.93e-01   1.56e-02   9.09e-01  -3.42e-02  -1.87e-02     0.0
     3   8.46e-01   2.18e-02   8.67e-01  -4.77e-02  -2.59e-02     0.0
     4   7.82e-01   2.94e-02   8.11e-01  -6.37e-02  -3.43e-02     0.0
     5   7.03e-01   3.70e-02   7.40e-01  -7.89e-02  -4.18e-02     0.0
     6   6.16e-01   4.18e-02   6.58e-01  -8.68e-02  -4.50e-02     0.0
     7   5.33e-01   4.12e-02   5.74e-01  -8.33e-02  -4.21e-02     0.0
     8   4.62e-01   3.59e-02   4.98e-01  -7.11e-02  -3.52e-02     0.0
     9   4.05e-01   2.89e-02   4.34e-01  -5.66e-02  -2.77e-02     0.0
    10   3.61e-01   2.26e-02   3.84e-01  -4.40e-02  -2.14e-02     …
    37   1.35e-01   9.69e-04   1.36e-01  -1.92e-03  -9.52e-04     0.0
    38   1.33e-01   9.17e-04   1.34e-01  -1.82e-03  -9.02e-04     0.0
    39   1.31e-01   8.70e-04   1.32e-01  -1.73e-03  -8.56e-04     0.0
    40   1.29e-01   8.26e-04   1.30e-01  -1.64e-03  -8.13e-04     0.0
    41   1.28e-01   7.86e-04   1.29e-01  -1.56e-03  -7.74e-04     0.0
    42   1.26e-01   7.49e-04   1.27e-01  -1.49e-03  -7.38e-04     0.0
    43   1.25e-01   7.14e-04   1.26e-01  -1.42e-03  -7.04e-04     0.0
    44   1.24e-01   6.82e-04   1.24e-01  -1.35e-03  -6.73e-04     0.0
    45   1.22e-01   6.52e-04   1.23e-01  -1.30e-03  -6.43e-04     0.0
    46   1.21e-01   6.24e-04   1.22e-01  -1.24e-03  -6.16e-04     0.0
    47   1.20e-01   5.98e-04   1.21e-01  -1.19e-03  -5.91e-04     0.0
    48   1.19e-01   5.74e-04   1.19e-01  -1.14e-03  -5.67e-04     0.0
    49   1.18e-01   5.51e-04   1.18e-01  -1.10e-03  -5.45e-04     0.0
    50   1.17e-01   5.30e-04   1.17e-01  -1.05e-03  -5.24e-04     0.0

</code></pre><pre><code class="language-julia hljs">fig = plot_amplitude(
    substitute(a, IdDict(a.control =&gt; opt_result_tanh.optimized_controls[1])),
    tlist
)</code></pre><p><img src="krotov_pulse_parametrization-48.png" alt/></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../">« List of Tutorials</a><a class="docs-footer-nextpage" href="../../examples/">List of Examples »</a><div class="flexbox-break"></div><p class="footer-message"><a href="https://github.com/JuliaQuantumControl/QuantumControlExamples.jl">JuliaQuantumControl Tutorials and Examples</a> powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="auto">Automatic (OS)</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.2.1 on <span class="colophon-date" title="Tuesday 23 January 2024 22:13">Tuesday 23 January 2024</span>. Using Julia version 1.10.0.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
