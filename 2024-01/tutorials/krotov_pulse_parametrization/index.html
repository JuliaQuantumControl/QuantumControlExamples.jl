<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Pulse Parametrization for Krotov&#39;s Method · Examples</title><meta name="title" content="Pulse Parametrization for Krotov&#39;s Method · Examples"/><meta property="og:title" content="Pulse Parametrization for Krotov&#39;s Method · Examples"/><meta property="twitter:title" content="Pulse Parametrization for Krotov&#39;s Method · Examples"/><meta name="description" content="Documentation for Examples."/><meta property="og:description" content="Documentation for Examples."/><meta property="twitter:description" content="Documentation for Examples."/><meta property="og:url" content="https://juliaquantumcontrol.github.io/QuantumControlExamples.jl/tutorials/krotov_pulse_parametrization/"/><meta property="twitter:url" content="https://juliaquantumcontrol.github.io/QuantumControlExamples.jl/tutorials/krotov_pulse_parametrization/"/><link rel="canonical" href="https://juliaquantumcontrol.github.io/QuantumControlExamples.jl/tutorials/krotov_pulse_parametrization/"/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../assets/citations.css" rel="stylesheet" type="text/css"/><link href="../../assets/custom.css" rel="stylesheet" type="text/css"/><script src="../../assets/custom.js"></script><link href="https://juliaquantumcontrol.github.io/QuantumControl.jl/dev/assets/topbar/topbar.css" rel="stylesheet" type="text/css"/><script src="https://juliaquantumcontrol.github.io/QuantumControl.jl/dev/assets/topbar/topbar.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">Examples</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="../">List of Tutorials</a></li><li class="is-active"><a class="tocitem" href>Pulse Parametrization for Krotov&#39;s Method</a><ul class="internal"><li><a class="tocitem" href="#Parametrizations"><span>Parametrizations</span></a></li><li><a class="tocitem" href="#Symmetric-Bounded-Controls"><span>Symmetric Bounded Controls</span></a></li><li><a class="tocitem" href="#Positive-(Bounded)-Controls"><span>Positive (Bounded) Controls</span></a></li><li><a class="tocitem" href="#Two-level-Hamiltonian"><span>Two-level Hamiltonian</span></a></li><li><a class="tocitem" href="#Optimization-target"><span>Optimization target</span></a></li><li><a class="tocitem" href="#Square-parametrization-for-positive-pulses"><span>Square-parametrization for positive pulses</span></a></li><li><a class="tocitem" href="#Tanh-Square-Parametrization-for-positive-amplitude-constrained-pulses"><span>Tanh-Square-Parametrization for positive amplitude-constrained pulses</span></a></li><li><a class="tocitem" href="#Logistic-Square-Parametrization-for-positive-amplitude-constrained-pulses"><span>Logistic-Square-Parametrization for positive amplitude-constrained pulses</span></a></li><li><a class="tocitem" href="#Tanh-parametrization-for-amplitude-constrained-pulses"><span>Tanh-parametrization for amplitude-constrained pulses</span></a></li></ul></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../../examples/">List of Examples</a></li></ul></li><li><a class="tocitem" href="../../references/">References</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Tutorials</a></li><li class="is-active"><a href>Pulse Parametrization for Krotov&#39;s Method</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Pulse Parametrization for Krotov&#39;s Method</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/JuliaQuantumControl/QuantumControlExamples.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/JuliaQuantumControl/QuantumControlExamples.jl/blob/master/docs/src/tutorials/krotov_pulse_parametrization/krotov_pulse_parametrization.jl" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Pulse-Parametrization-for-Krotov&#39;s-Method"><a class="docs-heading-anchor" href="#Pulse-Parametrization-for-Krotov&#39;s-Method">Pulse Parametrization for Krotov&#39;s Method</a><a id="Pulse-Parametrization-for-Krotov&#39;s-Method-1"></a><a class="docs-heading-anchor-permalink" href="#Pulse-Parametrization-for-Krotov&#39;s-Method" title="Permalink"></a></h1><p><span>$\gdef\op#1{\hat{#1}}$</span> <span>$\gdef\init{\text{init}}$</span> <span>$\gdef\tgt{\text{tgt}}$</span></p><p>This example illustrates the parametrization of control pulses as a form of amplitude constraint.</p><pre><code class="language-julia hljs">datadir(names...) = joinpath(@__DIR__, names...);</code></pre><pre><code class="language-julia hljs">using QuantumControl
using QuantumControl.Shapes: flattop
using QuantumControl.Generators
using QuantumControl.Controls
using QuantumControl.PulseParametrizations:
    SquareParametrization,
    TanhParametrization,
    TanhSqParametrization,
    LogisticParametrization,
    LogisticSqParametrization,
    ParametrizedAmplitude
using QuantumPropagators: ExpProp
using LinearAlgebra</code></pre><pre><code class="language-julia hljs">using Plots
Plots.default(
    linewidth               = 3,
    size                    = (550, 300),
    legend                  = :top,
    foreground_color_legend = nothing,
    background_color_legend = RGBA(1, 1, 1, 0.8),
)</code></pre><h2 id="Parametrizations"><a class="docs-heading-anchor" href="#Parametrizations">Parametrizations</a><a id="Parametrizations-1"></a><a class="docs-heading-anchor-permalink" href="#Parametrizations" title="Permalink"></a></h2><h2 id="Symmetric-Bounded-Controls"><a class="docs-heading-anchor" href="#Symmetric-Bounded-Controls">Symmetric Bounded Controls</a><a id="Symmetric-Bounded-Controls-1"></a><a class="docs-heading-anchor-permalink" href="#Symmetric-Bounded-Controls" title="Permalink"></a></h2><pre><code class="language-julia hljs">include(joinpath(@__DIR__, &quot;plots&quot;, &quot;symmetric_parametrization_comparison.jl&quot;))  # hide
fig = plot_symmetric_parametrization_comparison()  # hide</code></pre><p><img src="krotov_pulse_parametrization-11.png" alt/></p><h2 id="Positive-(Bounded)-Controls"><a class="docs-heading-anchor" href="#Positive-(Bounded)-Controls">Positive (Bounded) Controls</a><a id="Positive-(Bounded)-Controls-1"></a><a class="docs-heading-anchor-permalink" href="#Positive-(Bounded)-Controls" title="Permalink"></a></h2><pre><code class="language-julia hljs">include(joinpath(@__DIR__, &quot;plots&quot;, &quot;positive_parametrization_comparison.jl&quot;))  # hide
fig = plot_positive_parametrization_comparison()  # hide</code></pre><p><img src="krotov_pulse_parametrization-13.png" alt/></p><h2 id="Two-level-Hamiltonian"><a class="docs-heading-anchor" href="#Two-level-Hamiltonian">Two-level Hamiltonian</a><a id="Two-level-Hamiltonian-1"></a><a class="docs-heading-anchor-permalink" href="#Two-level-Hamiltonian" title="Permalink"></a></h2><p>We consider the Hamiltonian <span>$\op{H}_{0} = - \frac{\omega}{2} \op{\sigma}_{z}$</span>, representing a simple qubit with energy level splitting <span>$\omega$</span> in the basis <span>$\{\ket{0},\ket{1}\}$</span>. The control field <span>$\epsilon(t)$</span> is assumed to couple via the Hamiltonian <span>$\op{H}_{1}(t) = \epsilon(t) \op{\sigma}_{x}$</span> to the qubit, i.e., the control field effectively drives transitions between both qubit states.</p><p>We we will use</p><pre><code class="language-julia hljs">ϵ(t) = 0.2 * flattop(t, T=5, t_rise=0.3, func=:blackman);</code></pre><pre><code class="language-julia hljs">&quot;&quot;&quot;Two-level-system Hamiltonian.&quot;&quot;&quot;
function tls_hamiltonian(; Ω=1.0, ampl=ϵ)
    σ̂_z = ComplexF64[
        1  0
        0 -1
    ]
    σ̂_x = ComplexF64[
        0  1
        1  0
    ]
    Ĥ₀ = -0.5 * Ω * σ̂_z
    Ĥ₁ = σ̂_x
    return hamiltonian(Ĥ₀, (Ĥ₁, ampl))
end;</code></pre><pre><code class="language-julia hljs">H = tls_hamiltonian();</code></pre><p>The control field here switches on from zero at <span>$t=0$</span> to it&#39;s maximum amplitude 0.2 within the time period 0.3 (the switch-on shape is half a <a href="https://en.wikipedia.org/wiki/Window_function#Blackman_window">Blackman pulse</a>). It switches off again in the time period 0.3 before the final time <span>$T=5$</span>). We use a time grid with 500 time steps between 0 and <span>$T$</span>:</p><pre><code class="language-julia hljs">tlist = collect(range(0, 5, length=500));</code></pre><pre><code class="language-julia hljs">function plot_amplitude(ampl, tlist)
    plot(tlist, discretize(ampl, tlist), xlabel=&quot;time&quot;, ylabel=&quot;amplitude&quot;, legend=false)
end

fig = plot_amplitude(ϵ, tlist)</code></pre><p><img src="krotov_pulse_parametrization-21.png" alt/></p><h2 id="Optimization-target"><a class="docs-heading-anchor" href="#Optimization-target">Optimization target</a><a id="Optimization-target-1"></a><a class="docs-heading-anchor-permalink" href="#Optimization-target" title="Permalink"></a></h2><p>The <code>krotov</code> package requires the goal of the optimization to be described by a list of <code>Objective</code> instances. In this example, there is only a single objective: the state-to-state transfer from initial state <span>$\ket{\Psi_{\init}} = \ket{0}$</span> to the target state <span>$\ket{\Psi_{\tgt}} = \ket{1}$</span>, under the dynamics of the Hamiltonian <span>$\op{H}(t)$</span>:</p><pre><code class="language-julia hljs">function ket(label)
    result = Dict(&quot;0&quot; =&gt; Vector{ComplexF64}([1, 0]), &quot;1&quot; =&gt; Vector{ComplexF64}([0, 1]),)
    return result[string(label)]
end;</code></pre><pre><code class="language-julia hljs">objectives = [Objective(initial_state=ket(0), generator=H, target_state=ket(1))]</code></pre><pre><code class="nohighlight hljs">1-element Vector{QuantumControlBase.Objective{Vector{ComplexF64}, QuantumPropagators.Generators.Generator{Matrix{ComplexF64}, typeof(Main.var&quot;##233&quot;.ϵ)}}}:
 Objective{Vector{ComplexF64}, QuantumPropagators.Generators.Generator{Matrix{ComplexF64}, typeof(Main.var&quot;##233&quot;.ϵ)}}(…)</code></pre><h2 id="Square-parametrization-for-positive-pulses"><a class="docs-heading-anchor" href="#Square-parametrization-for-positive-pulses">Square-parametrization for positive pulses</a><a id="Square-parametrization-for-positive-pulses-1"></a><a class="docs-heading-anchor-permalink" href="#Square-parametrization-for-positive-pulses" title="Permalink"></a></h2><pre><code class="language-julia hljs">a = ParametrizedAmplitude(
    ϵ,
    tlist;
    parametrization=SquareParametrization(),
    parameterize=true
)</code></pre><pre><code class="nohighlight hljs">ParametrizedAmplitude(::Vector{Float64}; parametrization=SquareParametrization())</code></pre><pre><code class="language-julia hljs">function plot_amplitude(ampl::ParametrizedAmplitude, tlist)
    plot(
        tlist,
        discretize(Array(ampl), tlist),
        xlabel=&quot;time&quot;,
        ylabel=&quot;amplitude&quot;,
        legend=false
    )
end

fig = plot_amplitude(a, tlist)</code></pre><p><img src="krotov_pulse_parametrization-28.png" alt/></p><pre><code class="language-julia hljs">problem = ControlProblem(
    objectives=substitute(objectives, IdDict(ϵ =&gt; a)),
    prop_method=ExpProp,
    lambda_a=5,
    update_shape=(t -&gt; flattop(t, T=5, t_rise=0.3, func=:blackman)),
    tlist=tlist,
    iter_stop=50,
    J_T=QuantumControl.Functionals.J_T_ss,
    check_convergence=res -&gt; begin
        ((res.J_T &lt; 1e-3) &amp;&amp; (res.converged = true) &amp;&amp; (res.message = &quot;J_T &lt; 10⁻³&quot;))
    end
);</code></pre><pre><code class="language-julia hljs">opt_result_positive = @optimize_or_load(
    datadir(&quot;parametrization#opt_result_positive.jld2&quot;),
    problem;
    method=:krotov
);</code></pre><pre><code class="language-julia hljs">opt_result_positive</code></pre><pre><code class="nohighlight hljs">Krotov Optimization Result
--------------------------
- Started at 2024-01-13T16:57:53.177
- Number of objectives: 1
- Number of iterations: 50
- Value of functional: 3.53585e-02
- Reason for termination: Reached maximum number of iterations
- Ended at 2024-01-13T16:57:56.765 (3 seconds, 588 milliseconds)
</code></pre><p>We can plot the optimized field:</p><pre><code class="language-julia hljs">fig = plot_amplitude(
    substitute(a, IdDict(a.control =&gt; opt_result_positive.optimized_controls[1])),
    tlist
)</code></pre><p><img src="krotov_pulse_parametrization-33.png" alt/></p><h2 id="Tanh-Square-Parametrization-for-positive-amplitude-constrained-pulses"><a class="docs-heading-anchor" href="#Tanh-Square-Parametrization-for-positive-amplitude-constrained-pulses">Tanh-Square-Parametrization for positive amplitude-constrained pulses</a><a id="Tanh-Square-Parametrization-for-positive-amplitude-constrained-pulses-1"></a><a class="docs-heading-anchor-permalink" href="#Tanh-Square-Parametrization-for-positive-amplitude-constrained-pulses" title="Permalink"></a></h2><pre><code class="language-julia hljs">a = ParametrizedAmplitude(
    ϵ,
    tlist;
    parametrization=TanhSqParametrization(3),
    parameterize=true
)

problem_tanhsq = ControlProblem(
    objectives=substitute(objectives, IdDict(ϵ =&gt; a)),
    prop_method=ExpProp,
    lambda_a=10,
    update_shape=(t -&gt; flattop(t, T=5, t_rise=0.3, func=:blackman)),
    tlist=tlist,
    iter_stop=50,
    J_T=QuantumControl.Functionals.J_T_ss,
    check_convergence=res -&gt; begin
        ((res.J_T &lt; 1e-3) &amp;&amp; (res.converged = true) &amp;&amp; (res.message = &quot;J_T &lt; 10⁻³&quot;))
    end
);</code></pre><pre><code class="language-julia hljs">opt_result_tanhsq = @optimize_or_load(
    datadir(&quot;parametrization#opt_result_tanhsq.jld2&quot;),
    problem_tanhsq;
    method=:krotov
);</code></pre><pre><code class="language-julia hljs">opt_result_tanhsq</code></pre><pre><code class="nohighlight hljs">Krotov Optimization Result
--------------------------
- Started at 2024-01-13T16:57:58.306
- Number of objectives: 1
- Number of iterations: 50
- Value of functional: 6.69321e-02
- Reason for termination: Reached maximum number of iterations
- Ended at 2024-01-13T16:57:58.786 (480 milliseconds)
</code></pre><p>We can plot the optimized field:</p><pre><code class="language-julia hljs">fig = plot_amplitude(
    substitute(a, IdDict(a.control =&gt; opt_result_tanhsq.optimized_controls[1])),
    tlist
)</code></pre><p><img src="krotov_pulse_parametrization-39.png" alt/></p><h2 id="Logistic-Square-Parametrization-for-positive-amplitude-constrained-pulses"><a class="docs-heading-anchor" href="#Logistic-Square-Parametrization-for-positive-amplitude-constrained-pulses">Logistic-Square-Parametrization for positive amplitude-constrained pulses</a><a id="Logistic-Square-Parametrization-for-positive-amplitude-constrained-pulses-1"></a><a class="docs-heading-anchor-permalink" href="#Logistic-Square-Parametrization-for-positive-amplitude-constrained-pulses" title="Permalink"></a></h2><pre><code class="language-julia hljs">a = ParametrizedAmplitude(
    ϵ,
    tlist;
    parametrization=LogisticSqParametrization(3, k=1.0),
    parameterize=true
)

problem_logisticsq = ControlProblem(
    objectives=substitute(objectives, IdDict(ϵ =&gt; a)),
    prop_method=ExpProp,
    lambda_a=1,
    update_shape=(t -&gt; flattop(t, T=5, t_rise=0.3, func=:blackman)),
    tlist=tlist,
    iter_stop=50,
    J_T=QuantumControl.Functionals.J_T_ss,
    check_convergence=res -&gt; begin
        ((res.J_T &lt; 1e-3) &amp;&amp; (res.converged = true) &amp;&amp; (res.message = &quot;J_T &lt; 10⁻³&quot;))
    end
);</code></pre><pre><code class="language-julia hljs">opt_result_logisticsq = @optimize_or_load(
    datadir(&quot;parametrization#opt_result_logisticsq.jld2&quot;),
    problem_logisticsq;
    method=:krotov
);</code></pre><p>We can plot the optimized field:</p><pre><code class="language-julia hljs">fig = plot_amplitude(
    substitute(a, IdDict(a.control =&gt; opt_result_logisticsq.optimized_controls[1])),
    tlist
)</code></pre><p><img src="krotov_pulse_parametrization-44.png" alt/></p><h2 id="Tanh-parametrization-for-amplitude-constrained-pulses"><a class="docs-heading-anchor" href="#Tanh-parametrization-for-amplitude-constrained-pulses">Tanh-parametrization for amplitude-constrained pulses</a><a id="Tanh-parametrization-for-amplitude-constrained-pulses-1"></a><a class="docs-heading-anchor-permalink" href="#Tanh-parametrization-for-amplitude-constrained-pulses" title="Permalink"></a></h2><pre><code class="language-julia hljs">a = ParametrizedAmplitude(
    ϵ,
    tlist;
    parametrization=TanhParametrization(-0.5, 0.5),
    parameterize=true
)

problem_tanh = ControlProblem(
    objectives=substitute(objectives, IdDict(ϵ =&gt; a)),
    prop_method=ExpProp,
    lambda_a=1,
    update_shape=(t -&gt; flattop(t, T=5, t_rise=0.3, func=:blackman)),
    tlist=tlist,
    iter_stop=50,
    J_T=QuantumControl.Functionals.J_T_ss,
    check_convergence=res -&gt; begin
        ((res.J_T &lt; 1e-3) &amp;&amp; (res.converged = true) &amp;&amp; (res.message = &quot;J_T &lt; 10⁻³&quot;))
    end
);</code></pre><pre><code class="language-julia hljs">opt_result_tanh = @optimize_or_load(
    datadir(&quot;parametrization#opt_result_tanh.jld2&quot;),
    problem_tanh;
    method=:krotov
);</code></pre><pre><code class="language-julia hljs">fig = plot_amplitude(
    substitute(a, IdDict(a.control =&gt; opt_result_tanh.optimized_controls[1])),
    tlist
)</code></pre><p><img src="krotov_pulse_parametrization-48.png" alt/></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../">« List of Tutorials</a><a class="docs-footer-nextpage" href="../../examples/">List of Examples »</a><div class="flexbox-break"></div><p class="footer-message"><a href="https://github.com/JuliaQuantumControl/QuantumControlExamples.jl">JuliaQuantumControl Tutorials and Examples</a> powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="auto">Automatic (OS)</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.2.1 on <span class="colophon-date" title="Saturday 13 January 2024 22:27">Saturday 13 January 2024</span>. Using Julia version 1.10.0.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
